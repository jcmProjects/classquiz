{% extends "quiz/base.html" %}
{% block content %}
{% csrf_token %}
    <main role="main" class="container-flex">
        <div class="row">
            <div class="col-md-12">
                <div class="card card-signin my-3">
                    <div class="card-body">

                        <!-- Author-->
                        <div class="media">
                            <img class="rounded-circle article-img" src="{{ object.author.profile.image.url }}">
                            <div class="media-body">
                                <div class="article-metadata">
                                    <a class="mr-2" href="{% url 'user-quiz' object.author.username %}">{{ object.author }}</a>
                                    <small class="text-muted">{{ object.date_created|date:"F d, Y" }}</small>    <!-- see DJANGO date formatting template documentation -->
                                    <!-- Options -->
                                    {% if object.author == user %}
                                        <a class="btn btn-outline-danger btn-sm mt-1 mb-1 mr-1" href="{% url 'quiz-delete' object.id %}">Delete</a>
                                        <a class="btn btn-outline-secondary btn-sm mt-1 mb-1" href="{% url 'quiz-edit' object.id %}">Edit</a>
                                    {% endif %}
                                    <button class="btn btn-outline-info btn-sm mt-1 mb-1 ml-1 mr-1" type="button" onClick=="showDetail()" id="show_btn">Show</button>
                                    {% if object.author == user %}
                                        <button class="btn btn-outline-success btn-sm mt-1 mb-1" type="button" onClick=="goFullscreen()" style="visibility: visible;" id="start_btn">Start</button>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- DETAIL -->
                        <!-- Quiz -->
                        <div class="container align-items-start bg-white" id="quiz_detail" style="display: none;"> <!-- align-items-center -->
                            <div class="row justify-content-center">  <!-- quiz-body  -->
                                <!-- Question -->
                                <div class="container">
                                    <div class="row justify-content-center" style="margin-top: 1.5vh;">
                                        <div class="col text-center font-weight-bold question-text">{{ object.question }}</div>
                                    </div>
                                </div>
                                <!-- Image -->
                                {% if quiz.image != "no_image.jpg" %}
                                    <div class="container">
                                        <div class="row justify-content-center quiz-detail-img" style="margin-top: 1.5vh;">
                                            <img class="quiz-show-img" src="{{ object.image.url }}">
                                        </div>
                                    </div>
                                {% endif %}
                                <!-- Answers / Timer -->
                                <div class="container">
                                    <div class="row justify-content-start align-items-center" style="margin-top: 1.5vh;">
                                        <!-- Answers -->
                                        <div class="col">
                                            <div class="text-left ans-text2"><b>a)    </b>{{ object.ansA }}</div>
                                            <div class="text-left ans-text2"><b>b)    </b>{{ object.ansB }}</div>
                                            <div class="text-left ans-text2"><b>c)    </b>{{ object.ansC }}</div>
                                            <div class="text-left ans-text2"><b>d)    </b>{{ object.ansD }}</div>
                                            <div class="text-left ans-text2"><b>e)    </b>{{ object.ansE }}</div>
                                        </div>
                                        <!-- Timer -->
                                        <div class="col">
                                            <div class="text-center font-weight-bold timer-text">{{ object.duration }}</span></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>

        <!-- FULLSCREEN -->
        <!-- Quiz -->
        <div class="container align-items-start bg-white" style="display: none;" id="myQuiz"> <!-- align-items-center -->
            <div class="row justify-content-center">  <!-- quiz-body  -->
                {% if quiz.image != "no_image.jpg" %}
                <!-- Question -->
                <div class="container">
                    <div class="row justify-content-center" style="margin-top: 4vh;">
                        <div class="col text-center font-weight-bold question-text2" style="height: 15vh; word-wrap: break-word;">{{ object.question }}</div>
                    </div>
                </div>
                <!-- Image -->
                <div class="container">
                    <div class="row justify-content-center quiz-detail-img" style="margin-top: 1vh;">
                        {% if quiz.image != "no_image.jpg" %}
                            <img class="quiz-show-img" src="{{ object.image.url }}">
                        {% endif %}
                    </div>
                </div>
                <!-- Answers / Timer -->
                <div class="container">
                    <div class="row justify-content-start align-items-center" style="margin-top: 1vh; margin-bottom: 1vh;">
                        <!-- Answers -->
                        <div class="col-sm" style="height: 25vh;">
                            <div class="col ans-text3 text-left" style="height: 5vh; word-wrap: break-word;"><b>a)    </b>{{ object.ansA }}</div>
                            <div class="col ans-text3 text-left" style="height: 5vh; word-wrap: break-word;"><b>b)    </b>{{ object.ansB }}</div>
                            <div class="col ans-text3 text-left" style="height: 5vh; word-wrap: break-word;"><b>c)    </b>{{ object.ansC }}</div>
                            <div class="col ans-text3 text-left" style="height: 5vh; word-wrap: break-word;"><b>d)    </b>{{ object.ansD }}</div>
                            <div class="col ans-text3 text-left" style="height: 5vh; word-wrap: break-word;"><b>e)    </b>{{ object.ansE }}</div>
                        </div>
                        <!-- Timer -->
                        <div class="row justify-content-end">
                            <div class="col text-center font-weight-bold timer-text2"><span id="time">{{ object.duration }}</span></div>
                        </div>
                    </div>
                </div>
                {% else %}
                <!-- Question -->
                <div class="container">
                    <div class="row justify-content-center" style="margin-top: 12.5vh;">
                        <div class="col text-center font-weight-bold question-text3" style="height: 25vh; word-wrap: break-word;">{{ object.question }}</div>
                    </div>
                </div>
                 <!-- Answers / Timer -->
                <div class="container">
                    <div class="row justify-content-start align-items-center" style="margin-top: 7.5vh;">
                        <!-- Answers -->
                        <div class="col-sm" style="height: 35vh;">
                            <div class="col ans-text4 text-left" style="height: 7vh; word-wrap: break-word;"><b>a)    </b>{{ object.ansA }}</div>
                            <div class="col ans-text4 text-left" style="height: 7vh; word-wrap: break-word;"><b>b)    </b>{{ object.ansB }}</div>
                            <div class="col ans-text4 text-left" style="height: 7vh; word-wrap: break-word;"><b>c)    </b>{{ object.ansC }}</div>
                            <div class="col ans-text4 text-left" style="height: 7vh; word-wrap: break-word;"><b>d)    </b>{{ object.ansD }}</div>
                            <div class="col ans-text4 text-left" style="height: 7vh; word-wrap: break-word;"><b>e)    </b>{{ object.ansE }}</div>
                        </div>
                    </div>
                </div>
                <!-- Timer -->
                <div class="container">
                    <div class="row justify-content-center align-items-center" style="margin-top: 5vh;">
                        <div class="row justify-content-end" style="height: 15vh;">
                            <div class="col text-center font-weight-bold timer-text3"><span id="time">{{ object.duration }}</span></div>
                        </div>
                    </div>
                </div>
                {% endif %}
                <!-- Footer Buttons -->
                <div class"container">
                    <div class="quiz-footer" id="btn_footer">
                        <button class="btn btn-outline-info btn-sm mb-1 mr-1" type="button" id="play_btn">Play</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Toggle Detail - JavaScript Function -->
        <script>
            document.getElementById("show_btn").addEventListener('click', function showDetail(){
                if (document.getElementById("quiz_detail").style.display == "none") {
                    document.getElementById("quiz_detail").style.display = "block";
                }
                else {
                    document.getElementById("quiz_detail").style.display = "none";
                }
            });
        </script>

        <!-- Detect Mobile - JavaScript Function -->
        <script>
            $(document).ready(function(){
                if( navigator.userAgent.match(/Android/i)
                || navigator.userAgent.match(/webOS/i)
                || navigator.userAgent.match(/iPhone/i)
                || navigator.userAgent.match(/iPad/i)
                || navigator.userAgent.match(/iPod/i)
                || navigator.userAgent.match(/BlackBerry/i)
                || navigator.userAgent.match(/Windows Phone/i) ) {
                    document.getElementById("start_btn").style.visibility = "hidden";
                }
            })
        </script>
        
        <!-- Go Fullscreen - JavaScript Function -->
        <script>
            document.getElementById("start_btn").addEventListener("click", function goFullscreen() {
                var elem = document.getElementById("myQuiz");
                if (elem.requestFullscreen) {
                    elem.requestFullscreen();
                } 
                else if (elem.msRequestFullscreen) {
                    elem.msRequestFullscreen();
                } 
                else if (elem.mozRequestFullScreen) {
                    elem.mozRequestFullScreen();
                } 
                else if (elem.webkitRequestFullscreen) {
                    elem.webkitRequestFullscreen();
                }

                document.getElementById("btn_footer").style.display = "block";
                document.getElementById("myQuiz").style.display = "block";
            });
        </script>

        <!-- Esc Pressed / Fullscreen Exit - JavaScript Function -->
        <script>
            document.addEventListener("fullscreenchange", function(event) {
                if (document.fullscreenElement) {
                    // Window is in fullscren. Do nothin.
                }
                else {
                    document.getElementById("btn_footer").style.display = "none";
                    document.getElementById("myQuiz").style.display = "none";
                }
            });
        </script>

        <!-- Timer - JavaScript Function -->
        <script>
            function startTimer(duration, display) {
                var start = Date.now(),
                    diff,
                    minutes,
                    seconds;
                function timer() {
                    // get the number of seconds that have elapsed since 
                    // startTimer() was called
                    diff = duration - (((Date.now() - start) / 1000) | 0);

                    if (diff <= 0) {
                        diff = 0;
                    }
                    display.textContent = diff;
                };
                // we don't want to wait a full second before the timer starts
                timer();
                setInterval(timer, 1000);
            }

            /* Play_btn (Abade) */
            document.getElementById("play_btn").addEventListener("click", function () {
                $.ajax({
                    type: "POST",
                    url: "start_quiz/",
                    data: { "quiz_id": {{ object.id }} },
                    dataType: 'json',
                    success: function(data, textStatus) {
                        console.log("test");
                    }
                });
                
                var timeRemaining = {{ object.duration }},
                    display = document.querySelector('#time');
                startTimer(timeRemaining, display);
            });
        </script>

    </main>
    {% block autoplay %}
    {% endblock autoplay %}
{% endblock content %}